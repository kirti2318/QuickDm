<%- include('partials/header') %>

<%- include('partials/side-menu') %>

<div class="main-content">
  <main class="content">
    <div class="template-header">
      <h2>ðŸ“‚ Templates</h2>
      <a href="/dashboard/templates/new" class="btn-primary">+ Create New Template</a>
    </div>

    <div class="card-container">
      <% prebuiltTemplates.forEach(template => { %>
        <div class="card">
          <h3><%= template.title %></h3>
          <p><%= template.content.length > 100 ? template.content.substring(0, 100) + '...' : template.content %></p>
          <a href="/dashboard/templates/edit/<%= template._id %>" class="btn-secondary">Edit Template</a>
        </div>
      <% }) %>

      <% templates.forEach(template => { %>
        <div class="card">
          <h3><%= template.title %></h3>
          <p><%= template.content.length > 100 ? template.content.substring(0, 100) + '...' : template.content %></p>
          <div class="card-buttons">
            <a href="/dashboard/templates/edit/<%= template._id %>" class="btn-secondary">Edit</a>
            <button class="btn-delete" data-id="<%= template._id %>">ðŸ—‘</button>
          </div>
        </div>
      <% }) %>
    </div>
  </main>
</div>

<!-- ===== Styles ===== -->
<style>
  .main-content {
    margin-left: 240px;
    padding: 2rem 1.5rem;
  }

  @media (max-width: 768px) {
    .main-content {
      margin-left: 0;
      padding: 1rem;
    }
  }

  .template-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .template-header h2 {
    font-size: 1.75rem;
    color: #333;
  }

  .card-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
  }

  .card {
    background: #ffffff;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-height: 180px;
  }

  .card h3 {
    margin: 0 0 10px;
    font-size: 1.25rem;
    color: #222;
  }

  .card p {
    color: #555;
    margin-bottom: 1.2rem;
    flex-grow: 1;
    font-size: 0.95rem;
    line-height: 1.4;
  }

  .card-buttons {
    display: flex;
    justify-content: space-between;
    gap: 0.5rem;
  }

  .btn-primary {
    background-color: #4f46e5;
    color: #fff;
    padding: 0.6rem 1rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    text-decoration: none;
  }

  .btn-secondary {
    background-color: #6c757d;
    color: #fff;
    padding: 0.5rem 0.9rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
    text-decoration: none;
  }

  .btn-delete {
    background-color: #dc3545;
    color: #fff;
    padding: 0.5rem 0.9rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
  }

  .btn-delete:hover,
  .btn-secondary:hover,
  .btn-primary:hover {
    opacity: 0.92;
  }
</style>

<!-- ===== Script ===== -->
<script>
  document.querySelectorAll('.btn-delete').forEach(btn => {
    btn.addEventListener('click', function () {
      const templateId = this.dataset.id;
      const confirmed = confirm("Are you sure you want to delete this template?");
      if (!confirmed) return;

      fetch(`/dashboard/templates/delete/${templateId}`, {
        method: "DELETE"
      })
      .then(res => res.json())
      .then(data => {
        if (data.message) {
          alert("Template deleted successfully!");
          location.reload();
        } else {
          alert(data.error || "Failed to delete template.");
        }
      })
      .catch(err => {
        console.error("Error:", err);
        alert("An unexpected error occurred.");
      });
    });
  });
</script>

<%- include('partials/footer') %>
